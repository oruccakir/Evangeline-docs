---
title: "ResNet50 Overview"
description: "Deep dive into the ResNet50 CNN implementation for FPGA"
---

## Introduction

ResNet50 is a 50-layer deep convolutional neural network designed for image classification on the ImageNet dataset (1000 classes). This implementation provides both CPU and FPGA execution paths.

## Architecture

The network follows a **Bottleneck** architecture with residual connections:

```
Input (224×224×3)
    │
    ▼
┌─────────────────┐
│      Stem       │  7×7 Conv (stride=2) → BatchNorm → ReLU → MaxPool
└────────┬────────┘
         │
    ┌────▼────┐
    │ Layer 1 │  3 Bottleneck Blocks (64 → 256 channels)
    └────┬────┘
    ┌────▼────┐
    │ Layer 2 │  4 Bottleneck Blocks (256 → 512 channels, stride=2)
    └────┬────┘
    ┌────▼────┐
    │ Layer 3 │  6 Bottleneck Blocks (512 → 1024 channels, stride=2)
    └────┬────┘
    ┌────▼────┐
    │ Layer 4 │  3 Bottleneck Blocks (1024 → 2048 channels, stride=2)
    └────┬────┘
         │
┌────────▼────────┐
│ Classification  │  Global AvgPool → FC (2048 → 1000)
└─────────────────┘
```

### Bottleneck Block

Each block contains:
- **1×1 Conv** → Reduce channels
- **3×3 Conv** → Spatial processing
- **1×1 Conv** → Expand channels
- **Residual Add** → Skip connection

---

## Directory Structure

```
resnet50/
├── CMakeLists.txt        # Build configuration
├── config.yaml           # Runtime configuration
├── config_fpga.yaml      # FPGA-specific config
├── imagenet_classes.txt  # Class labels (1000)
├── images/               # Sample test images
├── datasets/             # ImageNette dataset
└── src/
    ├── main.cpp              # Entry point
    ├── forward.cpp           # CPU forward pass
    ├── forward_fpga.cpp      # FPGA forward pass
    ├── weight.hpp            # Weight structures
    ├── tensor.hpp            # Tensor abstraction
    ├── benchmark.cpp         # ImageNette benchmarking
    ├── single_inference.cpp  # Single image inference
    ├── cpu_kernels.cpp       # CPU kernel implementations
    ├── kernels_fpga.cpp      # FPGA kernel wrappers (OpenCL)
    └── kernel_*.cpp          # HLS kernel sources
```

---

## FPGA Kernels

| Kernel | Function | Description |
|--------|----------|-------------|
| `kernel_conv2d` | Convolution | 2D convolution with padding and stride |
| `kernel_batchnorm` | Batch Normalization | Normalize + optional fused ReLU |
| `kernel_relu` | ReLU Activation | Element-wise max(0, x) |
| `kernel_maxpool` | Max Pooling | 2D max pooling with stride |
| `kernel_avgpool` | Global Avg Pool | Spatial averaging to 1×1 |
| `kernel_fc` | Fully Connected | Matrix-vector multiplication |
| `kernel_add` | Residual Add | Element-wise addition |

---

## Building

Before running inference, you need to build the application. See the [Build & Configuration](/architecture/build-and-config) guide for full details.

### CPU-Only Build (Quick Test)

```bash
cd resnet50
mkdir build && cd build
cmake ..
make -j$(nproc)
```

### FPGA Build

```bash
./build.sh --config=build_configs/resnet50_hw_build_v0/.yaml
```

<Tip>
The FPGA build takes 4-8 hours. Use CPU builds for development and testing.
</Tip>

---

## Running Inference

### CPU Mode

For quick testing without FPGA hardware:

```bash
# Single image
./main --config ../config.yaml

# Or with CLI arguments
./main \
    --weight_path ../weights.bin \
    --single_image ../images/dog.jpg \
    --labels_path ../imagenet_classes.txt
```

**CPU Config Example (`config.yaml`):**
```yaml
weight_path: ./weights.bin
labels_path: ./imagenet_classes.txt
single_image: ./images/apple.jpg
```

### FPGA Mode

For hardware-accelerated inference on ZCU102:

```bash
# On the board (after deployment)
./resnet50_host --config /run/media/mmcblk0p1/config_fpga.yaml
```

**FPGA Config Example (`config_fpga.yaml`):**
```yaml
weight_path: /run/media/mmcblk0p1/resnet50/weights.bin
xclbin_path: /run/media/mmcblk0p1/resnet50/binary_container_1.xclbin
labels_path: /run/media/mmcblk0p1/resnet50/imagenet_classes.txt
single_image: /run/media/mmcblk0p1/resnet50/images/apple.jpg
```

<Note>
The `xclbin_path` parameter is **required** for FPGA mode. If omitted, the application falls back to CPU.
</Note>

---

## Configuration Parameters

| Parameter | Description | Required |
|-----------|-------------|----------|
| `weight_path` | Path to pre-trained weights binary | Yes |
| `labels_path` | Path to ImageNet class labels file | Yes |
| `xclbin_path` | Path to FPGA binary (`.xclbin`) | FPGA only |
| `single_image` | Path to input image (JPG/PNG) | For single inference |
| `dataset_path` | Path to ImageNette validation set | For benchmarking |
| `samples_per_class` | Number of samples per class to test | For benchmarking |
| `output_csv` | Path to save benchmark results | Optional |
| `verbose` | Enable detailed logging (0 or 1) | Optional |

---

## Benchmark Results

The implementation supports Top-1 through Top-5 accuracy metrics and throughput measurement using the ImageNette dataset (10-class subset of ImageNet).

| Metric | Description |
|--------|-------------|
| Top-1 Accuracy | Correct if highest prediction matches label |
| Top-5 Accuracy | Correct if label is in top 5 predictions |
| Throughput | Images processed per second |
| Avg Inference Time | Milliseconds per image |
